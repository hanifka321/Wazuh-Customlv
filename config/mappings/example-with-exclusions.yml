metadata:
  name: example-wazuh-mapping-with-exclusions
priority: global

# Entity exclusions - these entities will not be stored in the database
# Supports:
# - Exact matches (e.g., "root", "admin")
# - Wildcard patterns (e.g., "system_*", "service_*", "SYSTEM")
excluded_entities:
  - root
  - admin
  - administrator
  - system_*
  - service_*
  - SYSTEM
  - NT AUTHORITY*

# Canonical mappings shared by every alert unless overridden
defaults:
  entity_id: "agent.id"
  entity_type: "host"
  severity: "rule.level"
  timestamp: "@timestamp"
  enrichment:
    agent_name: "agent.name"
    rule_description: "rule.description"
    source_ip: "data.srcip"
    destination_ip: "data.dstip"

selectors:
  - name: rule-9100-overrides
    match:
      rule_id: "9100"
    fields:
      severity: "15"
      enrichment:
        analyst_note: "High confidence correlation"

sources:
  wazuh:
    defaults:
      severity: "data.severity"
    selectors:
      - name: wazuh-login-failure
        match:
          group: "authentication_failed"
        fields:
          entity_type: "user"
          entity_id: "data.srcuser"
          enrichment:
            username: "data.srcuser"
            outcome: "result"
      - name: wazuh-correlation-rule
        match:
          rule_id: "5715"
        fields:
          severity: "rule.level"
          enrichment:
            correlation: "rule.description"
  osquery:
    defaults:
      entity_type: "endpoint"
      enrichment:
        pack: "osquery.pack"
    selectors:
      - name: osquery-privilege-changes
        match:
          custom:
            pack: "privilege_escalation"
        fields:
          severity: "high"
          enrichment:
            escalation_reason: "event.reason"
